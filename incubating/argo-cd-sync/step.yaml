kind: step-type
metadata:
  name: argo-cd-sync
  version: 0.4.1
  isPublic: true
  description: Syncs Argo CD apps managed by our GitOps Runtimes
  sources:
    - 'https://github.com/codefresh-io/steps/tree/master/incubating/argo-cd-sync'
  stage: incubating
  maintainers:
    - name: Francisco Cocozza
    - email: francisco@codefresh.io
  categories:
    - GitOps
  official: true
  tags: []
  icon:
    type: svg
    url: https://cdn.jsdelivr.net/gh/codefresh-io/steps/graduated/argocd-sync/argo.svg
    background: "#f4f4f4"
  examples:
    - description: Sync an Argo CD app called "my-app" in a GitOps Runtime called "my-runtime"
      workflow:
        sync_argo_cd_app:
          title: Sync Argo CD app
          type: argo-cd-sync
          arguments:
            RUNTIME: my-runtime
            APPLICATION: my-app

spec:
  arguments: |-
    {
      "definitions": {},
      "$schema": "http://json-schema.org/draft-07/schema#",
      "type": "object",
      "additionalProperties": true,
      "patterns": [],
      "required": [
        "RUNTIME",
        "APPLICATION"
      ],
      "properties": {
        "RUNTIME": {
          "type": "string",
          "description": "The name of the GitOps Runtime managing the Argo CD Application"
        },
        "APPLICATION": {
          "type": "string",
          "description": "The name of the Argo CD Application to be synced"
        },
        "IMAGE_NAME": {
          "type": "string",
          "default": "quay.io/codefreshplugins/argo-cd-sync"
        },
        "IMAGE_TAG": {
          "type": "string",
          "default": "0.4.1"
        }
      }
    }
  stepsTemplate: |-
    argo-cd-sync:
      image: '[[.Arguments.IMAGE_NAME]]:[[.Arguments.IMAGE_TAG]]'
      working_directory: /app
      environment:
      [[ range $key, $val := .Arguments ]]
        - '[[ $key ]]=[[ $val ]]'
      [[- end ]]
      commands:
        - python3 run.py
  delimiters:
    left: '[['
    right: ']]'
