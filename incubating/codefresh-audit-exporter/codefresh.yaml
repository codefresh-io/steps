version: '1.0'

stages:
- google

steps:
  main_clone:
    type: git-clone
    repo: codefresh-io/steps
    revision: ${{CF_REVISION}}
    git: cf_github
  
  build_google:
    stage: google
    type: build
    image_name: codefresh/audit-exporter-google
    working_directory: ${{main_clone}}/incubating/codefresh-audit-exporter
    dockerfile: Dockerfile.google
    tag: ${{CF_REVISION}}
  
  PushingToRegistries:
    title: Pushing to Registry
    type: push
    stage: google
    candidate:  ${{build_google}}
    tags:
    - "latest"
    when:
      branch:
        only:
        - master
    scale:
      PushingToDockerHubRegistry:
        title: Pushing To DockerHub Registry
        registry: dockerhub
      PushingToQuayRegistry:
        title: Pushing To Quay Registry
        registry: cfpluginmgr-quay
